

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Installation Instructions &mdash; PyMad 0.2.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="PyMad 0.2.0 documentation" href="../index.html" />
    <link rel="next" title="Examples" href="../examples/index.html" />
    <link rel="prev" title="CERN PyMad" href="../index.html" /> 
  </head>
  <body>

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../index.html"><img src="../_static/pymad-logo-text.png" border="0" alt="py4sci"/></a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../examples/index.html" title="Examples"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../index.html" title="CERN PyMad"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">home</a>|&nbsp;</li>
        <li><a href="../search.html">search</a>|&nbsp;</li>
 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Installation Instructions</a><ul>
<li><a class="reference internal" href="#jpymad">JPyMad</a></li>
<li><a class="reference internal" href="#cpymad-unix">CPyMad (unix)</a></li>
<li><a class="reference internal" href="#cython-windows-mingw">Cython (windows, MinGW)</a></li>
<li><a class="reference internal" href="#potential-problems">Potential problems</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../index.html"
                        title="previous chapter">CERN PyMad</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../examples/index.html"
                        title="next chapter">Examples</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/installation/index.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="installation-instructions">
<h1>Installation Instructions<a class="headerlink" href="#installation-instructions" title="Permalink to this headline">¶</a></h1>
<p>Installation of PyMad is different depending on which underlying modules you want.</p>
<div class="section" id="jpymad">
<h2>JPyMad<a class="headerlink" href="#jpymad" title="Permalink to this headline">¶</a></h2>
<p>For JPyMad, you first need JMad which you can obtain <a class="reference external" href="http://cern.ch/jmad/">here</a>
Then, download the <a class="reference external" href="https://github.com/pymad/pymad">source</a>, and in pymad/src, run
the command</p>
<div class="highlight-sh"><div class="highlight"><pre>python setup.py install --install-platlib
</pre></div>
</div>
<p>The argument <em>&#8211;install-platlib</em> means we exclude external modules. The reason is that the external module cern.madx requires the dynamic library of Mad-X available on your system (which we here assume you do not have)</p>
</div>
<div class="section" id="cpymad-unix">
<h2>CPyMad (unix)<a class="headerlink" href="#cpymad-unix" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>First method, use installation script:</dt>
<dd><p class="first">We provide an <a class="reference external" href="install.sh">installation script</a> which should do the full job for you. Download the script
and run it. It will take a few minutes to finish. Upon successful completion, it will create an uninstall.sh
script which you should keep somewhere. This script knows all the files you have installed,
and will remove all files if you execute it (folders are not removed).</p>
<p class="last">Dependencies: cmake, compilers for c/fortran, python 2.6 or 2.7</p>
</dd>
</dl>
<p>Second method, source script:</p>
<blockquote>
<div><p>For CPymad on a 64 bit Linux machine with afs available, it is enough to source the script that we
currently provide in</p>
<blockquote>
<div>/afs/cern.ch/user/y/ylevinse/public/setupCPYMAD.sh</div></blockquote>
<p>We hope to in the near future provide a tarball for Linux and OSX containing all needed files.</p>
</div></blockquote>
<p>Third method, manual installation:</p>
<blockquote>
<div><ul>
<li><p class="first">Download the Mad-X source from
<a class="reference external" href="http://svnweb.cern.ch/world/wsvn/madx/trunk/madX/?op=dl&amp;rev=0&amp;isdir=1">svn</a>
and unpack it.</p>
</li>
<li><p class="first">Enter the folder madX and run the commands</p>
<div class="highlight-sh"><div class="highlight"><pre>mkdir build; <span class="nb">cd </span>build
cmake -DMADX_STATIC<span class="o">=</span>OFF -DBUILD_SHARED_LIBS<span class="o">=</span>ON ../
make install
</pre></div>
</div>
</li>
<li><p class="first">Download the PyMad source from <a class="reference external" href="https://github.com/pymad/pymad/zipball/master">github</a>
and unpack it</p>
</li>
<li><p class="first">In the folder pymad/src, run the command</p>
<div class="highlight-sh"><div class="highlight"><pre>python setup.py install
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
<p>If you download JMad after following any of the methods described above for CPyMad,
you will immediately have JPyMad available as well.</p>
</div>
<div class="section" id="cython-windows-mingw">
<h2>Cython (windows, MinGW)<a class="headerlink" href="#cython-windows-mingw" title="Permalink to this headline">¶</a></h2>
<p>At this time you have to build pymad manually.</p>
<blockquote>
<div><ul>
<li><p class="first">If you want to install all system dependencies at once, I recommend <a class="reference external" href="https://code.google.com/p/pythonxy/">Python(x,y)</a>. This is a python development distribution including MinGW, Cython and Python2.7. Make sure Cython and MinGW are marked for installation.</p>
</li>
<li><p class="first">Download the Mad-X source from
<a class="reference external" href="http://svnweb.cern.ch/world/wsvn/madx/trunk/madX/?op=dl&amp;rev=0&amp;isdir=1">svn</a>
and unpack it.</p>
</li>
<li><p class="first">Build the Mad-X library as a <strong>shared library</strong> (<tt class="docutils literal"><span class="pre">.dll</span></tt>).
Enter the folder madX and run the commands</p>
<div class="highlight-bat"><div class="highlight"><pre>mkdir build &amp;&amp; <span class="k">cd</span> build
cmake -G <span class="s2">&quot;MinGW Makefiles&quot;</span> -DBUILD_SHARED_LIBS:BOOL<span class="o">=</span><span class="k">ON</span> -DCMAKE_INSTALL_PREFIX<span class="o">=</span>..\madx-redist ..\
make install
</pre></div>
</div>
<p>This will install the headers, binaries and library files to the folder <tt class="docutils literal"><span class="pre">..\madx-redist</span></tt>.</p>
<p>Executing CMake from the GUI, you have to add the <tt class="docutils literal"><span class="pre">BUILD_SHARED_LIBS</span></tt> option manually. Afterwards reconfigure and regenerate.</p>
</li>
<li><p class="first">Alternatively, if you have already built a static library you can convert it to a dynamic library using <tt class="docutils literal"><span class="pre">pexports</span></tt> and <tt class="docutils literal"><span class="pre">dlltool</span></tt> like so:</p>
<div class="highlight-bat"><div class="highlight"><pre>mingw-get install mingw<span class="m">32</span>-pexports

ar -x libptc.a
gcc -shared *.obj -o libptc.dll -lgfortran
pexports libptc.dll <span class="p">&gt;</span><span class="n">libptc</span>.def
dlltool --dllname libptc.dll --def libptc.def --output-lib libptc.dll.a
<span class="k">del</span> *.obj libptc.def

ar -x libmadx.a
gcc -shared *.obj -o libmadx.dll -L. -lptc.dll -lstdc++ -lgfortran
pexports libmadx.dll <span class="p">&gt;</span><span class="n">libmadx</span>.def
dlltool --dllname libmadx.dll --def libmadx.def --output-lib libmadx.dll.a
<span class="k">del</span> *.obj libmadx.def
</pre></div>
</div>
</li>
<li><p class="first">In the folder <tt class="docutils literal"><span class="pre">pymad/src</span></tt>, run the command</p>
<div class="highlight-bat"><div class="highlight"><pre>python setup.py install --madxdir<span class="o">=</span><span class="p">&lt;</span><span class="n">path</span>-to-your&gt;\madx-redist
</pre></div>
</div>
<p>It is highly unlikely that your build succeeds at this point. See <a class="reference internal" href="#potential-problems"><em>Potential problems</em></a> for further information.</p>
</li>
<li><p class="first">Copy the <tt class="docutils literal"><span class="pre">.dll</span></tt> library files to either your system or better your applications runtime path.</p>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="potential-problems">
<span id="id2"></span><h2>Potential problems<a class="headerlink" href="#potential-problems" title="Permalink to this headline">¶</a></h2>
<p>In the following we will try to keep a list of the various issues users have reported during installation.</p>
<blockquote>
<div><ul>
<li><p class="first">libmadx.so not found:</p>
<div class="highlight-python"><pre>from cern.madx import madx
ImportError: libmadx.so: cannot open shared object file: No such file or directory</pre>
</div>
<p>Solution:
Though we try to set the runtime path during compilation, it doesn&#8217;t always work. Please set
the LD_LIBRARY_PATH in your environment. Example, if libmadx.so is installed in
$HOME/.local/lib, and you use bash, add to $HOME/.bashrc:</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nb">export </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$LD_LIBRARY_PATH</span>:<span class="nv">$HOME</span>/.local/lib/
</pre></div>
</div>
<p>Please note, on OSX you might need to use the variable DYLD_LIBRARY_PATH instead of
LD_LIBRARY_PATH. The authors are not very familiar with OSX, but know of at least one
occurence where that was the problem.</p>
</li>
<li><p class="first">Cython.Distutils not found:</p>
<div class="highlight-sh"><div class="highlight"><pre>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
 File <span class="s2">&quot;setup.py&quot;</span>, line 22, in &lt;module&gt;
  from Cython.Distutils import build_ext
ImportError: No module named Cython.Distutils
</pre></div>
</div>
</li>
</ul>
<blockquote>
<div>Solution:
In order to get cpymad, you need Cython installed on your system. If you cannot obtain that, use jpymad instead.</div></blockquote>
<ul>
<li><p class="first">Cannot find find -lpthread:</p>
<p>Occurs:
When linking libmadx with the <tt class="docutils literal"><span class="pre">-DMADX_STATIC:BOOL=ON</span></tt> cmake option specified.</p>
<p>Reason:
A static version of pthreads is not installed by default.</p>
<p>Solution:
Download a <a class="reference external" href="http://www.sourceware.org/pthreads-win32/">prebuilt version of the library</a>. You need the file <tt class="docutils literal"><span class="pre">libpthreadGC2.a</span></tt>. Copy it to <tt class="docutils literal"><span class="pre">C:\MinGW32-xy\lib\libpthread.a</span></tt>.</p>
</li>
<li><p class="first">Unable to find vcvarsall.bat:</p>
<p>Occurs:
While building <tt class="docutils literal"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">install</span></tt>.</p>
<p>Reason:
distutils is not configured to use MinGW.</p>
<p>Solution:
Add the following lines to <tt class="docutils literal"><span class="pre">C:\Python27\Lib\distutils\distutils.cfg</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="n">build</span><span class="p">]</span>
<span class="n">compiler</span><span class="o">=</span><span class="n">mingw32</span>
</pre></div>
</div>
<p>If you do not want to modify your python system configuration you can place this as <tt class="docutils literal"><span class="pre">setup.cfg</span></tt> in the current directory. You can also specify the compiler on the command line:</p>
<div class="highlight-bat"><div class="highlight"><pre>python setup.py build --madxdir<span class="o">=</span><span class="p">&lt;</span><span class="n">path</span>-to-your&gt;\madx-redist --compiler<span class="o">=</span>mingw<span class="m">32</span>
python setup.py install --madxdir<span class="o">=</span><span class="p">&lt;</span><span class="n">path</span>-to-your&gt;\madx-redist
</pre></div>
</div>
<p>See also <a class="reference external" href="http://stackoverflow.com/questions/2817869/error-unable-to-find-vcvarsall-bat">this question on stackoverflow</a>.</p>
</li>
<li><p class="first">distutils.unixcompiler not configured:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="o">...</span>
  <span class="n">File</span> <span class="s">&quot;C:\Python27\lib\distutils\unixccompiler.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">227</span><span class="p">,</span> <span class="ow">in</span> <span class="n">runtime_library_dir_option</span>
    <span class="n">compiler</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">sysconfig</span><span class="o">.</span><span class="n">get_config_var</span><span class="p">(</span><span class="s">&quot;CC&quot;</span><span class="p">))</span>
  <span class="n">File</span> <span class="s">&quot;C:\Python27\lib</span><span class="se">\n</span><span class="s">tpath.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">198</span><span class="p">,</span> <span class="ow">in</span> <span class="n">basename</span>
    <span class="k">return</span> <span class="n">split</span><span class="p">(</span><span class="n">p</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
  <span class="n">File</span> <span class="s">&quot;C:\Python27\lib</span><span class="se">\n</span><span class="s">tpath.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">170</span><span class="p">,</span> <span class="ow">in</span> <span class="n">split</span>
    <span class="n">d</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">splitdrive</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
  <span class="n">File</span> <span class="s">&quot;C:\Python27\lib</span><span class="se">\n</span><span class="s">tpath.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">125</span><span class="p">,</span> <span class="ow">in</span> <span class="n">splitdrive</span>
    <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;:&#39;</span><span class="p">:</span>
<span class="ne">TypeError</span><span class="p">:</span> <span class="s">&#39;NoneType&#39;</span> <span class="nb">object</span> <span class="n">has</span> <span class="n">no</span> <span class="n">attribute</span> <span class="s">&#39;__getitem__&#39;</span>
</pre></div>
</div>
<p>Occurs:
While building <tt class="docutils literal"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">install</span></tt>.</p>
<p>Reason:
Bug in distutils (?).</p>
<p>Solution:
Add the following line to the function <tt class="docutils literal"><span class="pre">_init_nt()</span></tt> in the file <tt class="docutils literal"><span class="pre">Lib\distutils\sysconfig.py</span></tt> of the python installation.</p>
<p>For further reference see <a class="reference external" href="http://bugs.python.org/issue2437">a related issue</a>.</p>
</li>
</ul>
</div></blockquote>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../examples/index.html" title="Examples"
             >next</a> |</li>
        <li class="right" >
          <a href="../index.html" title="CERN PyMad"
             >previous</a> |</li>
        <li><a href="../index.html">home</a>|&nbsp;</li>
        <li><a href="../search.html">search</a>|&nbsp;</li>
 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Y.I. Levinsen, K. Fuchsberger (CERN) .
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>